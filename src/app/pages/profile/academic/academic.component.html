<app-navbar></app-navbar>

<div class="p-8 bg-gray-100 min-h-screen pt-32">
  <!-- Si hay un académico seleccionado mostramos la ficha de detalle -->
  <ng-container *ngIf="selectedAcademic; else listView">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-2xl p-10 relative">
      <div class="flex flex-col md:flex-row gap-10 items-start">
        <div class="md:w-1/2 flex flex-col gap-6">
          <div class="rounded-lg overflow-hidden bg-gray-50 shadow-inner">
            <img [src]="selectedAcademic.fotoPerfil" [alt]="selectedAcademic.nombre" class="w-full h-96 object-cover" />
          </div>

          <div class="flex flex-col gap-4 mt-6">
            <button class="px-7 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-xl font-semibold shadow-md"
              (click)="openImageModal(selectedAcademic.oficinaImagen)" [disabled]="!selectedAcademic.oficinaImagen">
              Ver imagen de oficina
            </button>
            <button class="px-7 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xl font-semibold shadow-md"
              (click)="openImageModal(selectedAcademic.horarioImagen)" [disabled]="!selectedAcademic.horarioImagen">
              Ver horario
            </button>
          </div>
        </div>

        <div class="md:w-1/2">
          <h2 class="text-6xl font-extrabold text-blue-700">{{ selectedAcademic.nombre }}</h2>
          <p class="text-2xl text-gray-500 mb-6">ID: {{ selectedAcademic.id }} • Rol: {{ selectedAcademic.rol || '—' }}</p>

          <div class="grid grid-cols-1 gap-6 text-2xl">
            <div>
              <h4 class="text-sm font-semibold text-gray-600">Departamento</h4>
              <p class="text-gray-800 text-2xl">{{ selectedAcademic.departamento || '—' }}</p>
            </div>
            <div>
              <h4 class="text-sm font-semibold text-gray-600">Oficina</h4>
              <p class="text-gray-800 text-2xl">{{ selectedAcademic.oficina || '—' }}</p>
            </div>
            <div>
              <h4 class="text-sm font-semibold text-gray-600">Email</h4>
              <p class="text-gray-800 text-2xl">{{ selectedAcademic.email || '—' }}</p>
            </div>
          </div>

        </div>
      </div>

      <!-- Modal grande para mostrar imagen -->
      <div *ngIf="modalOpen" class="modal-backdrop fixed inset-0 z-50 flex items-center justify-center">
        <!-- wrapper: stopPropagation para evitar que clicks internos cierren el modal -->
        <div class="modal-wrapper relative w-[95vw] max-w-5xl max-h-[90vh] bg-white rounded-lg shadow-2xl overflow-hidden" (click)="$event.stopPropagation()">
          <button (click)="closeModal()" aria-label="Cerrar" class="modal-close absolute top-3 right-3 z-50 bg-white rounded-full p-2">✕</button>
          <div class="modal-body flex items-center justify-center bg-black p-4">
            <div class="modal-image-container w-full h-full flex items-center justify-center">
              <img [src]="modalImage" alt="Imagen" class="modal-image object-contain max-h-[80vh] max-w-full" />
            </div>
          </div>
          <div class="modal-footer absolute left-4 bottom-4 z-60">
            <a routerLink="/academicos" (click)="closeModal()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Volver a académicos</a>
          </div>
        </div>
        <!-- backdrop: click aquí cierra -->
        <div class="absolute inset-0" (click)="closeModal()"></div>
      </div>

      <div class="card-back-button absolute right-4 bottom-4 z-60">
        <a routerLink="/academicos" class="inline-block px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 text-base">Volver a académicos</a>
      </div>
    </div>
  </ng-container>

  <ng-template #listView>
  <div class="flex flex-col md:flex-row items-center mb-8 gap-4">
    <input
      type="text"
      placeholder="Buscar académico..."
      [(ngModel)]="searchText"
      class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
    <button
      (click)="clearFilters()"
      class="px-5 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition"
    >
      Limpiar
    </button>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
    <div
      *ngFor="let academic of filteredAcademics()"
      class="block rounded-2xl overflow-hidden shadow-lg bg-white hover:shadow-2xl transition-all duration-300"
    >
      <div class="w-full h-72 relative">
        <a [routerLink]="['/academico', academic.id]" class="absolute inset-0 z-10">
          <!-- El enlace ocupa todo el área de la imagen pero sólo activa la navegación al hacer clic sobre la imagen -->
        </a>
        <img
          [src]="academic.fotoPerfil"
          [alt]="academic.nombre"
          class="w-full h-full object-cover rounded-t-2xl"
        />
      </div>
      <div class="p-4 text-center cursor-default">
        <h3 class="text-xl font-bold text-blue-700">{{ academic.nombre }}</h3>
        <p class="text-gray-600">{{ academic.oficina }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="filteredAcademics().length === 0" class="mt-16 text-center p-8 bg-white rounded-xl shadow-lg">
    <h3 class="text-xl font-semibold text-gray-800 mb-2">No se encontraron académicos</h3>
    <p class="text-gray-600">Intenta ajustar tu búsqueda.</p>
  </div>
  </ng-template>
</div>

<app-footer></app-footer>
